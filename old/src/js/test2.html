<script type="text/javascript">
    awaitJquery.push(function() {
        var itemKeys = Object.keys(page.items);
        for (var i = 0; i < itemKeys.length; i++) {
            var key = itemKeys[i];
            var item = page.items[key];
            var dataEl = $('.cms-item[data-item="' + item.id + '"]');
            var listItem = dataEl.parents('[role="listitem"]');
            if (listItem && Object.keys(item).length) {
                addAttrs(listItem, item);
            }
            if (i + 1 >= itemKeys.length) {

                var lists = $('[data-sort="season"] [role="list"]');

                lists.each(function(index) {

                    var list = $(this);
                    var items = list.find('[role="listitem"][data-season-end]');
                    items.sort(function(a, b) {
                        var aN = parseInt($(a).attr('data-season-end'));
                        var bN = parseInt($(b).attr('data-season-end'));
                        var anAfter = aN > bN;
                        return bN - aN;
                    }).appendTo(list);
                });


                var reqLibLists = $('[data-require-library]');
                reqLibLists.each(function() {
                    var list = $(this);
                    var listLib = list.attr('data-require-library');
                    var items = list.find('[role="listitem"]');
                    items.each(function(index) {
                        var item = $(items).eq(index);
                        var lib = item.attr('data-library');

                        if (!lib || lib != listLib) {

                            item.remove();
                        }
                    })
                });

                var requireSeason = $('[data-require-season]');

                requireSeason.each(function() {
                    var attrs, attr, list;
                    var passed = true;
                    list = $(this);
                    var season = list.attr('data-require-season');
                    attr = 'data-season-' + season;

                    if (attr.indexOf(' ') > -1) {
                        attr = attr.trim();
                    }
                    if (attr) {

                        $(this).find('[role="listitem"][data-season-' + season + '="false"]').remove();
                    }
                });
            }
        }
    });

    function addAttrs(target, data) {
        for (var attr in data) {
            var value = data[attr];

            if (!value || value === null) {

                target.attr('data-' + attr, 'false');
            } else if (typeof value != "object" && typeof value !== "function") {
                target.attr('data-' + attr, value);
            } else if (typeof value == "object" && Array.isArray(value)) {
                if (value.length) {

                    for (var i = 0; i < value.length.length; i++) {
                        target.attr('data-' + attr + '-' + attr[i], true);
                        target.attr('data-' + attr, attr.join(','));
                    }
                }

            } else if (value !== null && typeof value == "object") {

                for (var attrKey in value) {
                    var dataAttr = 'data-' + attr + '-' + attrKey;
                    target.attr(dataAttr, value[attrKey]);
                }

            }

        }
    }

    function cmsItemAction(id, action) {
        var dataEl = $('.cms-item[data-item="' + id + '"]');
        dataEl.parents('[role="listitem"]')[action]();
    }

    function onEachEl(items, callback) {
        items.each(function() {

            var item = $(this);
            callback(item);
        });
    }

    function getSeason({
        start,
        end,
        active
    }) {
        var ts = new Date();
        ts = ts.getTime();
        if (start && start != "" && end && end != "") {

            var tsMin = Date.parse(start) || false;
            var tsMax = Date.parse(end) || false;
            var active = tsMin < ts && tsMax > ts;
            var past = tsMax < ts;
            var future = tsMin > ts;
            return {
                start: tsMin,
                end: tsMax,
                active,
                past,
                future
            }

        }
    }
    var templates = {};
    templates.vote = {
        itemClasses: {

        },
        code: `
<div data-item="${item.id}" data-library="${item.library}" data-collection="${item.cid}" class="dynamic-vote-card visible voting-enabled show" id="vote-item-${item.id}">
    <div class="vote-card voting-enabled">
        <div class="vote-card-row">
            <h4 class="card-title">Nov.2020 - Feature Voting Item - 9</h4>
            <p class="card-body small">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat. Aenean faucibus nibh et justo cursus id rutrum lorem imperdiet. Nunc ut sem vitae risus tristique posuere.</p>
            <div class="pt-20"><a href="/learn/nov-2020-feature-voting-item-9" class="button small primary-flat w-inline-block">
                    <div>Learn more</div>
                    <div class="sr">&nbsp;about&nbsp;</div>
                    <div class="sr">Nov.2020 - Feature Voting Item - 9</div>
                </a></div>
            <div data-require-season-active="true" class="vote-btn-wrapper w-condition-invisible">
                <div aria-role="submit" tabindex="0" aria-label="Vote now! Total Votes: 0" class="vote-btn show">
                    <div data-vote-text="true" class="vote-icon if-enabled"></div>
                    <div data-display-vote="true" class="vote-btn-text votes-display">0</div>
                </div>
            </div>
            <div data-require-season-inactive="true" class="vote-btn-wrapper vote-disabled visible">
                <div aria-role="submit" tabindex="0" aria-label="Vote now! Total Votes: 0" class="vote-btn show">
                    <div data-vote-text="true" class="vote-icon if-enabled"></div>
                    <div data-display-vote="true" class="vote-btn-text votes-display">0</div>
                </div>
            </div>
        </div>
    </div>
</div>
`
    }
</script>

<template id="template-_ITEMID" data-library="vote">

</template>